@startuml Retry Mechanism with Backoff
!theme plain
skinparam backgroundColor #FEFEFE
skinparam shadowing false

title Luminara - Retry Mechanism with Backoff Strategy

actor "User Code" as User
participant "LuminaraClient" as Client
participant "Driver" as Driver
participant "Retry Handler" as Retry
participant "Backoff Strategy" as Backoff
participant "HTTP" as HTTP

User -> Client: api.get('/users', {retry: 3})
activate Client

Client -> Driver: request(config)
activate Driver

Driver -> Retry: Initialize retry context
activate Retry

Retry -> HTTP: Attempt 1
activate HTTP
HTTP --> Retry: ❌ Network Error (500)
deactivate HTTP

Retry -> Retry: Check retry conditions\n- attempt < maxRetries\n- status in retryStatusCodes

Retry -> Backoff: Calculate delay(attempt=1)
activate Backoff

alt Linear Backoff
	Backoff -> Backoff: delay = baseDelay * attempt
else Exponential Backoff
	Backoff -> Backoff: delay = baseDelay * 2^(attempt-1)
else Fibonacci Backoff
	Backoff -> Backoff: delay = baseDelay * fib(attempt)
else Decorrelated Jitter
	Backoff -> Backoff: delay = random(baseDelay, prevDelay * 3)
end

Backoff --> Retry: delay = 1000ms
deactivate Backoff

Retry -> Retry: Wait 1000ms

Retry -> HTTP: Attempt 2
activate HTTP
HTTP --> Retry: ❌ Network Error (503)
deactivate HTTP

Retry -> Backoff: Calculate delay(attempt=2)
activate Backoff
Backoff --> Retry: delay = 2000ms
deactivate Backoff

Retry -> Retry: Wait 2000ms

Retry -> HTTP: Attempt 3
activate HTTP
HTTP --> Retry: ✅ Success (200)
deactivate HTTP

Retry --> Driver: Success response
deactivate Retry

Driver --> Client: Response data
deactivate Driver

Client --> User: Return data
deactivate Client

@enduml
